<?php require_once 'includes/auth.php'; require_login(); ?>
<!doctype html><html><head><meta charset='utf-8'><title>Alerts</title><link rel='stylesheet' href='style.css'></head><body>
<div class='card'><h2>Active Alerts</h2><div id='active'>Loading...</div><h3>Resolved Alerts</h3><div id='resolved'>Loading...</div><p><a href='menu.php'>Back to Menu</a></p></div>
<script>
async function load(){ const a=await fetch('alerts.json').then(r=>r.json()); const r=await fetch('resolved.json').then(r=>r.json()); const active=document.getElementById('active'); active.innerHTML=''; a.forEach(it=>{ const div=document.createElement('div'); div.className='alert '+(getSeverity(it.message)); div.innerHTML=`<div><strong>${it.unit}</strong>: ${it.message}<br/><small>${it.timestamp}</small></div>`; <?php if(is_admin()){ echo "const btn=document.createElement('button'); btn.textContent='Resolve'; btn.onclick=function(){ resolve("+ 'it.id' +"); }; div.appendChild(btn);"; } ?> active.appendChild(div);}); const resolved=document.getElementById('resolved'); r.forEach(it=>{ const div=document.createElement('div'); div.className='alert '+(getSeverity(it.message)); div.innerHTML=`<div><strong>${it.unit}</strong>: ${it.message}<br/><small>Resolved: ${it.resolved}</small></div>`; resolved.appendChild(div);}); }
function getSeverity(msg){ msg=msg.toLowerCase(); if(msg.includes('fault')||msg.includes('shutdown')||msg.includes('error')||msg.includes('fail')) return 'error'; if(msg.includes('filter')||msg.includes('maintenance')||msg.includes('low')||msg.includes('high')||msg.includes('check')) return 'warning'; return 'info'; }
async function resolve(id){ try{ await fetch('resolve_alert.php',{method:'POST', headers: {'Content-Type':'application/x-www-form-urlencoded'}, body:'id='+encodeURIComponent(id)}); }catch(e){ console.log('simulate'); } load(); }
load(); </script></body></html>