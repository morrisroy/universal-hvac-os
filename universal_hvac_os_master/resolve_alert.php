<?php header('Content-Type: application/json'); require_once __DIR__ . '/includes/send_notifications.php'; $alertsFile='alerts.json'; $resolvedFile='resolved.json'; if($_SERVER['REQUEST_METHOD']==='POST' && isset($_POST['id'])){ $id=intval($_POST['id']); $alerts = json_decode(file_get_contents($alertsFile), true) ?: []; $resolved = json_decode(file_get_contents($resolvedFile), true) ?: []; $found=null; foreach($alerts as $i=>$a){ if($a['id']==$id){ $found=$a; $found['resolved']=date('c'); $resolved[]=$found; array_splice($alerts,$i,1); break; } } if($found){ file_put_contents($alertsFile,json_encode($alerts,JSON_PRETTY_PRINT)); file_put_contents($resolvedFile,json_encode($resolved,JSON_PRETTY_PRINT)); notify_all('HVAC Alert Resolved: '.($found['unit']??'Unknown'), 'Alert resolved: '.($found['message']??$found['alert']??'')."\nID: {$found['id']}"); echo json_encode(['status'=>'ok']); exit; } echo json_encode(['status'=>'error','message'=>'not found']); exit; } echo json_encode(['status'=>'error','message'=>'invalid']); ?>